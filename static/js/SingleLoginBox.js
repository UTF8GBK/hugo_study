function getDomain(e){e=/^.+:\/\/[^/]+\//.exec(e+"/");return e&&0<e.length?e[0].substr(0,e[0].length-1):null}function getTopDomain(e){if(0<=e.indexOf("localhost"))return"localhost";var n=/((\d+\.){3}\d+|[^.]+\.([^.]+|com.cn|net.cn|org.cn|gov.cn))$/.exec(e);return n&&0<n.length?n[0]:e}function getLoginHost(){for(var e=document.getElementsByTagName("script"),n="/SingleLoginBox/SingleLoginBox.js".toLowerCase(),t=0;t<e.length;t++){var o=e[t].src.toLowerCase();if(0<o.indexOf(n))return getDomain(o)}return null}function SingleLoginBoxFn(e){var n,t,o,i,a,c,r;window.autoLoginResult||(e=e||{},window.autoLogin&&!0!==e.isCallback?window.autoLogin(function(){},function(){e.isCallback=!0,SingleLoginBoxFn(e)}):(n=getLoginHost(),t=e.language&&"t"===e.language?"zh-tw":"zh-cn",o=e.qrtype||2,i=e.urlParams||"",a=e.iframeWidth||480,c=e.iframeHeight||594,r=e.headHeight||43,layer.open({type:1,title:["",""],shade:.5,move:!1,content:$("#login_page"),area:[a+"px",c+r+"px"],fixed:!0,success:function(){$("#login_page").html('<iframe src="'+n+"/page/loginpop?pop=true&qrtype="+o+"&lan="+t+i+'" style="width:'+a+"px;height:"+c+'px;border:none;"></iframe>'),e.successFn&&(e.that?e.successFn.call(e.that):e.successFn())},cancel:function(){$("#login_page").html(""),e.cancelFn&&(e.that?e.cancelFn.call(e.that):e.cancelFn())},end:function(){$("#login_page").html(""),e.endFn&&(e.that?e.endFn.call(e.that):e.endFn())}})))}function SingleLoginOutFn(n){$.get("/SingleLogin/SignOut?terminal=Web&r="+Math.random(),function(e){try{singleLoginBoxDelCookie("USER_LOGIN"),singleLoginBoxDelCookie("userKey")}catch(e){console.log(e)}n&&n()})}function singleChangePwFn(e){var n=getDomain($("script[src$='/SingleLoginBox/SingleLoginBox.js']")[0].src),t=e.language&&"t"==e.language?"zh-tw":"zh-ch";layer.open({type:1,title:["",""],shade:.5,move:!1,content:$("#change_page"),area:"480px",fixed:!0,success:function(){$("#change_page").html('<iframe src="'+n+"/home/changePw?PhoneNumber="+encodeURI(e.PhoneNumber)+"&PhoneCountryCode="+encodeURI(e.PhoneCountryCode)+"&rCode="+encodeURI(e.rCode)+"&lan="+t+"&qrtype="+encodeURI(e.qrtype)+"&userKey="+encodeURI(e.userKey)+' " style="width:480px;height:399px;border:none;"></iframe>'),e.successFn&&(e.that?e.successFn.call(e.that):e.successFn())},cancel:function(){$("#change_page").html(""),e.cancelFn&&(e.that?e.cancelFn.call(e.that):e.cancelFn())},end:function(){$("#change_page").html(""),e.endFn&&(e.that?e.endFn.call(e.that):e.endFn())}})}function setComplete(){var e=$(".sure_set_pw"),n=$(".set_pw");e&&(e.hide(),n.show()),layer.closeAll(),layer.msg("设置成功")}function getBaseDomain(){var e=location.host;return/((\d+\.){3}\d+|[^.]+\.([^.]+|com.cn|net.cn|org.cn|gov.cn))$/.test(e),RegExp.$1}function singleLoginBoxDelCookie(e){var n=new Date;n.setTime(n.getTime()-1),document.cookie=e+"=;domain="+getBaseDomain()+";expires="+n.toGMTString()+";path=/"}function delCookie(e){var n=new Date;n.setTime(n.getTime()-1),document.cookie=e+"=;domain="+getBaseDomain()+";expires="+n.toGMTString()+";path=/"}function delCookies(e,n){var t=new Date;t.setTime(t.getTime()-1),document.cookie=e+"=;domain="+getBaseDomain()+";expires="+t.toGMTString()+";path=/",n&&(document.cookie=e+"=;expires="+t.toGMTString()+";path=/")}function getCookie(e){try{var n=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),t=document.cookie.match(n);return t?decodeURIComponent(t[2]):null}catch(e){return null}}function singleLoginBoxGetsec(e){var n=+e.substring(1,e.length);switch(e.substring(0,1)){case"s":return 1e3*n;case"m":return 60*n*1e3;case"h":return 60*n*60*1e3;default:return 24*n*60*60*1e3}}function singleLoginBoxSetCookie(e,n,t){var o=new Date;t?(t=singleLoginBoxGetsec(t),o.setTime(o.getTime()+ +t)):o=new Date("9999-01-01"),document.cookie=e+"="+n+";domain="+getBaseDomain()+";expires="+o.toGMTString()+";path=/"}function getAjaxMethod(){var t=function(){},o=new XMLHttpRequest;return o.onload=function(){if(403!==o.status&&t){var e;try{200===o.status&&(e=JSON.parse(o.responseText))}catch(e){console.error(e)}t.call(this,e||{})}},function(e,n){t=n,o.open("GET",e),o.send()}}window.onmessage=function(e){try{var n,i;e.data&&"[object String]"===Object.prototype.toString.call(e.data)&&("success"===(n=JSON.parse(e.data)).set?setComplete():1===n.login||3===n.login?setTimeout(function(){try{n.accountPassword&&singleLoginBoxSetCookie("USER_ACCOUNT",encodeURIComponent(n.accountPassword),"d15")}catch(e){console.log(e)}LoginComplete&&LoginComplete()},0):4===n.login&&(layer.closeAll(),i=setInterval(function(){var e=getCookie("userKey"),n=getCookie("USER_LOGIN"),t=getCookie("bind"),o=getCookie("sessionId");t&&o&&(clearInterval(i),thirdLoginBindTelFn&&thirdLoginBindTelFn(t,o)),e&&n&&(clearInterval(i),thirdLoginCompleteFn&&thirdLoginCompleteFn(e,n))},1e3)))}catch(e){console.log(e)}},function(){var o,i,a,c,r,l,t=0;function s(e){a(o+"/login/getuserKey?clientId="+(e=null==e?i:e),function(e){t++;var n,e=e.BodyMessage||e.bodyMessage;e?(e="string"==typeof e?JSON.parse(e):e,(uk=e.UserKey||e.userKey)?(n=e.UserInfo||e.userInfo,u(uk,n,1),g(uk,n)):(uk=e.LoggedOutUserKey||e.loggedOutUserKey)&&g(uk)):t<3?setTimeout(s,1e3):g()})}function g(){for(var e,t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);for(l=2===arguments.length?(window.autoLoginResult={userKey:t[0],userInfo:t[1]},e=c,function(e){e&&e.apply(this,t)}):(e=r,function(e,n){n&&n.apply(this,t)}),n=0;n<e.length;n++){var o=e[n];o&&o.apply(this,t)}}function u(e,n,t){var o=getTopDomain(location.host);t=new Date(Date.now()+24*t*3600*1e3),e=e||"",n=null!==n&&"object"==typeof n?JSON.stringify(n):"",document.cookie="userKey="+e+";path=/;domain="+o+";expires="+t,document.cookie="USER_LOGIN="+n+";path=/;domain="+o+";expires="+t}window.autoLogin=function(e,n){if(l)l(e,n);else{if(c)return c.push(e),void r.push(n);if(o=getLoginHost(),i=Date.now()+Math.random().toString(),a="function"==typeof $&&"function"==typeof $.get?$.get:getAjaxMethod(),c=[e],r=[n],e=navigator.userAgent,n=-1<e.indexOf("Safari")&&-1===e.indexOf("Chrome"),e=o+"/login/setuserKey?clientId="+i,n){var n="prevClientId",t=localStorage.getItem(n);if(t&&""!==t&&0<=location.search.indexOf("clientId="+t))return void(s(t),localStorage.removeItem(n));localStorage.setItem(n,i),location.href=e}else{t=document.createElement("link");t.setAttribute("rel","prerender"),t.setAttribute("href",e+"&flag=1"),document.body.appendChild(t),(t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("href",e+"&flag=2"),t.onload=function(){s(null)},document.body.appendChild(t)}}},window.signOut=function(e){var n;u(null,null,-1),!0!==e&&(o=getLoginHost(),e=getDomain(location.href),n=location.href.substr(e.length),location.href=o+"/login/signOut?returnUrl="+encodeURIComponent(e).replace(/\./g,"%E3%80%82")+n)}}();